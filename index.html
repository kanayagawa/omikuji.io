<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>ãƒ‡ã‚¸ã‚¿ãƒ«ãŠã¿ãã˜</title>
  <style>
    :root{
      --bg:#f7f7fb; --fg:#0f172a; --muted:#475569; --border:#e5e7eb;
      --card:#fff; --primary:#2563eb; --shadow:0 12px 28px rgba(15,23,42,.10);
      --accent:#f59e0b; --success:#10b981;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{margin:0;height:100%}
    body{
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
      background:var(--bg); color:var(--fg); line-height:1.6;
      display:flex; align-items:center; justify-content:center; padding:20px;
    }
    .wrap{width:min(720px,100%); margin:auto}
    header{ text-align:center; margin-bottom:12px }
    h1{ margin:0; font-size:clamp(22px,5vw,32px)}
    .sub{ color:var(--muted); font-size:clamp(13px,3.5vw,15px); margin-top:4px}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:18px;
      box-shadow:var(--shadow); padding:18px; margin:14px 0; position:relative; overflow:hidden;
    }
    .paper{
      background:linear-gradient(180deg,#fff 0%,#fff 60%,#fff8ec 100%);
      border:1px dashed #d6d3d1; border-radius:14px; padding:22px;
      text-align:center; transform:translateY(6px); animation:pop .45s ease;
    }
    @keyframes pop{from{opacity:.0; transform:translateY(18px) scale(.98)} to{opacity:1; transform:translateY(6px) scale(1)}}
    .title{font-weight:800; font-size:clamp(22px,6vw,30px); margin:0 0 6px}
    .emoji{font-size:clamp(36px,10vw,48px); margin:2px 0 10px}
    .desc{color:var(--muted); margin-bottom:10px}
    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:8px}
    .pill{
      border:1px solid var(--border); border-radius:12px; padding:10px 12px;
      display:flex; align-items:center; justify-content:space-between; background:#fff;
      font-size:clamp(14px,3.8vw,16px)
    }
    .pill span:first-child{ color:#64748b }
    .actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:14px }
    .btn{
      appearance:none; border:1px solid var(--border); background:#fff; color:var(--fg);
      padding:14px 16px; border-radius:14px; font-weight:700; cursor:pointer; min-width:140px;
      box-shadow:var(--shadow); font-size:16px;
    }
    .btn:active{ transform:translateY(1px) }
    .primary{ background:var(--primary); color:#fff; border-color:transparent }
    .ghost{ background:transparent }
    .tiny{ text-align:center; color:#64748b; font-size:12px; margin-top:10px }
    /* confetti */
    .confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden }
    .confetti i{
      position:absolute; top:-10vh; width:8px; height:14px; opacity:.9;
      transform:translateY(-100%); animation:fall linear forwards;
    }
    @keyframes fall{
      to{ transform:translateY(120vh) rotate(720deg) }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸ² ãƒ‡ã‚¸ã‚¿ãƒ«ãŠã¿ãã˜</h1>
      <div class="sub">ã‚¹ãƒãƒ›ã§ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã€ä»Šæ—¥ã®é‹å‹¢ã‚’ã©ã†ãã€‚</div>
    </header>

    <section class="card">
      <div class="paper" id="paper">
        <div class="title" id="resultTitle">ãŠã¿ãã˜æœªå®Ÿè¡Œ</div>
        <div class="emoji" id="resultEmoji">ğŸ”®</div>
        <div class="desc" id="resultBody">ã€ŒãŠã¿ãã˜ã‚’å¼•ãã€ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚</div>

        <div class="grid" aria-live="polite">
          <div class="pill"><span>æ‹æ„›</span><span id="love">â€”</span></div>
          <div class="pill"><span>ä»•äº‹</span><span id="work">â€”</span></div>
          <div class="pill"><span>å­¦æ¥­</span><span id="study">â€”</span></div>
          <div class="pill"><span>å¥åº·</span><span id="health">â€”</span></div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="drawBtn">ãŠã¿ãã˜ã‚’å¼•ã</button>
        <button class="btn" id="shareBtn">çµæœã‚’å…±æœ‰</button>
        <button class="btn ghost" id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
      <div class="tiny">â€» åŒæ—¥2å›ç›®ã¯ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºï¼ˆã€Œãƒªã‚»ãƒƒãƒˆã€ã§è§£é™¤ï¼‰</div>
    </section>
  </div>

  <div class="confetti" id="fx" aria-hidden="true"></div>

  <script>
    // --- elements
    const T = (id)=>document.getElementById(id);
    const resultTitle=T("resultTitle"), resultEmoji=T("resultEmoji"), resultBody=T("resultBody");
    const love=T("love"), work=T("work"), study=T("study"), health=T("health");
    const fx=T("fx");

    // --- fortune table (weights = å‡ºç¾ç‡)
    const fortunes = [
      { name:"å¤§å‰", emoji:"ğŸ‰", weight:10,  desc:"æœ€é«˜ã®ä¸€æ—¥ã€‚ç©æ¥µçš„ã«å‹•ã“ã†ï¼", confetti:true },
      { name:"ä¸­å‰", emoji:"ğŸ˜Š", weight:25,  desc:"è‰¯ã„æµã‚Œã€‚æ‰‹ã‚’æŠœã‹ãšã«å‰é€²ã€‚" },
      { name:"å°å‰", emoji:"ğŸ™‚", weight:28,  desc:"å°ã•ãªå¹¸ã›ã‚ã‚Šã€‚æº–å‚™ã‚’æ€ ã‚‰ãšã€‚" },
      { name:"æœ«å‰", emoji:"ğŸ˜", weight:22,  desc:"ç„¦ã‚‰ãšç€å®Ÿã«ã€‚åŸºç¤ã‚’å¤§åˆ‡ã«ã€‚" },
      { name:"å‡¶",   emoji:"ğŸ˜±", weight:15,  desc:"ç„¡ç†ã¯ç¦ç‰©ã€‚æ…é‡ã•ãŒéµã€‚" }
    ];
    const subs = ["æœ€é«˜","è‰¯å¥½","æ™®é€š","æ³¨æ„","è¦è‡ªæ„›"];

    // --- helpers
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];
    function weightedPick(items){
      const total = items.reduce((s,x)=>s+x.weight,0);
      let r = Math.random()*total;
      for(const it of items){ r-=it.weight; if(r<=0) return it; }
      return items[items.length-1];
    }
    function todayKey(){ return new Date().toISOString().slice(0,10); }
    function canDraw(){ return localStorage.getItem("omikuji:lastDate") !== todayKey(); }

    function render(res){
      resultTitle.textContent = res.main.name;
      resultEmoji.textContent = res.main.emoji;
      resultBody.textContent  = res.main.desc;
      love.textContent   = res.details.love;
      work.textContent   = res.details.work;
      study.textContent  = res.details.study;
      health.textContent = res.details.health;
    }

    function confettiBurst(){
      // simple, lightweight confetti
      fx.innerHTML="";
      const colors=["#f59e0b","#10b981","#3b82f6","#ef4444","#8b5cf6","#14b8a6"];
      const n = 40;
      for(let i=0;i<n;i++){
        const s=document.createElement("i");
        const left=Math.random()*100;
        const dur=1.2+Math.random()*1.0;
        const delay=Math.random()*0.2;
        s.style.left=left+"vw";
        s.style.background=colors[Math.floor(Math.random()*colors.length)];
        s.style.animationDuration=dur+"s";
        s.style.animationDelay=delay+"s";
        fx.appendChild(s);
      }
      // auto clear
      setTimeout(()=>fx.innerHTML="",2200);
      if (navigator.vibrate) navigator.vibrate(15);
    }

    function draw(){
      if(!canDraw()){
        alert("ä»Šæ—¥ã¯æ—¢ã«å¼•ã„ã¦ã„ã¾ã™ï¼ˆ1æ—¥1å›ï¼‰ã€‚ã€Œãƒªã‚»ãƒƒãƒˆã€ã§ç„¡åŠ¹åŒ–ã§ãã¾ã™ã€‚");
        return;
      }
      const main = weightedPick(fortunes);
      const details = { love:pick(subs), work:pick(subs), study:pick(subs), health:pick(subs) };
      const res = { main, details, date: todayKey() };
      render(res);
      localStorage.setItem("omikuji:lastDate", res.date);
      localStorage.setItem("omikuji:lastResult", JSON.stringify(res));
      if(main.confetti) confettiBurst();
    }

    function loadTodayIfAny(){
      try{
        const saved = JSON.parse(localStorage.getItem("omikuji:lastResult")||"null");
        if(saved && saved.date === todayKey()) render(saved);
      }catch(e){}
    }

    async function share(){
      const text = `ä»Šæ—¥ã®é‹å‹¢ï¼š${resultTitle.textContent}ï¼ˆ${resultBody.textContent}ï¼‰`;
      const data = { title:"ãƒ‡ã‚¸ã‚¿ãƒ«ãŠã¿ãã˜", text, url:location.href };
      try{
        if(navigator.share){ await navigator.share(data); }
        else{
          await navigator.clipboard.writeText(`${data.title}\n${data.text}\n${data.url}`);
          alert("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚SNSã«è²¼ã‚Šä»˜ã‘ã¦ã‚·ã‚§ã‚¢ã§ãã¾ã™ã€‚");
        }
      }catch(e){}
    }

    function reset(){
      localStorage.removeItem("omikuji:lastDate");
      localStorage.removeItem("omikuji:lastResult");
      render({
        main:{name:"ãŠã¿ãã˜æœªå®Ÿè¡Œ", emoji:"ğŸ”®", desc:"ã€ŒãŠã¿ãã˜ã‚’å¼•ãã€ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚"},
        details:{love:"â€”",work:"â€”",study:"â€”",health:"â€”"}
      });
    }

    // --- bind
    document.getElementById("drawBtn").addEventListener("click", draw);
    document.getElementById("shareBtn").addEventListener("click", share);
    document.getElementById("resetBtn").addEventListener("click", reset);
    loadTodayIfAny();
  </script>
</body>
</html>
